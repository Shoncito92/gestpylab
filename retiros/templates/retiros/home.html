<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Dashboard - GestPyLab</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="container mt-4">
    <div class="row">
        <div class="col-12">
            <h1>¬°Bienvenido al Sistema de Retiros - GestPyLab!</h1>
            <p class="lead">Hoy es {{ hoy }}. Hora actual: {{ now|time:"H:i" }} (solo agendamos 11:00-14:00).</p>
        </div>
    </div>
    
    <div class="row mt-4">
        <div class="col-md-3">
            <div class="card text-center">
                <div class="card-body">
                    <h5 class="card-title">Pendientes Hoy</h5>
                    <h2 class="text-primary">{{ total_pendientes }}</h2>
                    <a href="{% url 'lista_pendientes' %}" class="btn btn-primary">Ver Detalle</a>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card text-center">
                <div class="card-body">
                    <h5 class="card-title">Solicitantes Registrados</h5>
                    <h2 class="text-info">{{ total_solicitantes }}</h2>
                    <a href="/admin/retiros/solicitante/" class="btn btn-info" target="_blank">Gestionar</a>
                </div>
            </div>
        </div>
        <div class="col-md-6">
            <div class="card">
                <div class="card-header">
                    <h5>Resumen por Retirador</h5>
                </div>
                <div class="card-body">
                    <ul class="list-group list-group-flush">
                        {% for res in res√∫menes %}
                            <li class="list-group-item d-flex justify-content-between align-items-center">
                                {{ res.retirador.nombre }} ({{ res.retirador.tipo }})
                                <span class="badge bg-{% if res.count > 0 %}danger{% else %}secondary{% endif %} rounded-pill">{{ res.count }}</span>
                                {% if res.count > 0 %}
                                    <a href="{% url 'lista_retirador' res.retirador.id %}" class="btn btn-sm btn-outline-primary ms-2">Ver Lista</a>
                                {% endif %}
                            </li>
                        {% empty %}
                            <li class="list-group-item">No hay retiradores configurados.</li>
                        {% endfor %}
                    </ul>
                </div>
            </div>
        </div>
    </div>
    
    <div class="row mt-4">
        <div class="col-12">
            <h3>Acciones R√°pidas</h3>
            <a href="{% url 'agregar_solicitud' %}" class="btn btn-success btn-lg me-2">‚ûï Agregar Nueva Solicitud</a>
            <a href="{% url 'lista_pendientes' %}" class="btn btn-info btn-lg me-2">üìã Ver Todas las Pendientes</a>
            {% if solicitantes_incompletos > 0 %}
                <a href="{% url 'notificar_datos_faltantes' %}" class="btn btn-warning btn-lg me-2">
                    <i class="fas fa-exclamation-triangle"></i> Revisar Datos Faltantes ({{ solicitantes_incompletos }})
                </a>
            {% endif %}
            <a href="/admin/" class="btn btn-secondary btn-lg" target="_blank">‚öôÔ∏è Admin (Ediciones Avanzadas)</a>
        </div>
    </div>
    
    <script>
        // Hora actual din√°mica (opcional, para ver si est√°s en horario)
        document.addEventListener('DOMContentLoaded', function() {
            const now = new Date();
            const hours = now.getHours();
            const timeElement = document.querySelector('.lead');
            if (hours >= 11 && hours <= 14) {
                timeElement.innerHTML += ' <span class="text-success">‚úÖ Horario de agendamiento activo</span>';
            } else {
                timeElement.innerHTML += ' <span class="text-warning">‚è∞ Fuera de horario (11:00-14:00)</span>';
            }
        });
    </script>
</body>
</html>